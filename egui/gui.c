/*
 * Initial main.c file generated by Glade. Edit as required.
 * Glade will not overwrite this file.
 */

/*
#ifdef HAVE_CONFIG_H
#  include <config.h>
#endif
*/
#  include <config.h>

#include <gtk/gtk.h>

#include "interface.h"
#include "support.h"
#include "callbacks.h"

#include "gui_throbber.h"
#include "gnmsprint.h"
#include <nemesi/egui.h>
#include <nemesi/comm.h>

int gui(struct rtsp_ctrl *rtsp_ctrl, nms_ui_hints * ui_hints, int argc, char *argv[])
{
	GtkWidget *nemesi;
	char *path;

	gtk_set_locale();
	// gtk_init(&argc, &argv);
	gtk_init(0, NULL);

	// add_pixmap_directory (PACKAGE_DATA_DIR "/" PACKAGE "/pixmaps");
	// add_pixmap_directory (PACKAGE_DATA_DIR "/" PACKAGE "/throbber");

	// throbber folder
	path = getenv(NEMESI_THROBBER_DIR_ENV);
	if (!path) {
		add_pixmap_directory(NEMESI_THROBBER_DIR_DEFAULT);
		nms_printf(NMSML_DBG1, "NEMESI_THROBBER_DIR_DEFAULT: " NEMESI_THROBBER_DIR_DEFAULT "\n");
	} else {
		add_pixmap_directory(path);
		nms_printf(NMSML_DBG1, "NEMESI_THROBBER_DIR_ENV: %s\n", path);
	}
	// pixmaps folder
	path = getenv(NEMESI_PIXMAPS_DIR_ENV);
	if (!path) {
		add_pixmap_directory(NEMESI_PIXMAPS_DIR_DEFAULT);
		nms_printf(NMSML_DBG1, "NEMESI_PIXMAPS_DIR_DEFAULT: " NEMESI_PIXMAPS_DIR_DEFAULT "\n");
	} else {
		add_pixmap_directory(path);
		nms_printf(NMSML_DBG1, "NEMESI_PIXMAPS_DIR_ENV: %s\n", path);
	}

	/*
	 * The following code was added by Glade to create one of each component
	 * (except popup menus), just so that you see something after building
	 * the project. Delete any components that you don't want shown initially.
	 */
	nemesi = create_nemesi();

	save_static_data(nemesi, rtsp_ctrl);	// must be done fist of all

	if (create_throbber(lookup_widget(nemesi, "hbox3")))
		nms_printf(NMSML_ERR, "no throbber available\n");

	gnmsprint_init();
	update_toolbar();
	gtk_widget_show(nemesi);

	if (ui_hints->url) {
		nms_printf(NMSML_NORM, "Connect: Please wait, opening \"%s\"", ui_hints->url);
		nms_open(rtsp_ctrl, ui_hints->url, gui_throbber, &rtsp_ctrl->busy);
		while (gtk_events_pending ()) gtk_main_iteration ();
		nms_play(rtsp_ctrl, -1, -1);
		gui_throbber(&rtsp_ctrl->busy);
	}
	
	gtk_main();
	return 0;
}
